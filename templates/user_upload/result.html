<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test result</title>
</head>
<body>
    <h2>Lysine TCGA</h2>
    <!----------- 这里可以换成 div ---------------->
    <table>
        <tr><th>user: </th><td{% if user_name %}{% endif %}>{{ user_name }}</td></tr>
        <tr><th>submit time: </th><td{% if submit_time %}{% endif %}>{{ submit_time }}</td></tr>
        <tr><th id="task_status">status: </th><td{% if status %}{% endif %}>{{ status }}</td></tr>
    </table>
    <!------------------------------------------->
    <table id="result_table" border="1" {% if test_result %}{% endif %}>
        <tr>
            <th>Cancer Type</th>
            <th>Uniprot Accession</th>
            <th>Position</th>
            <th>From</th>
            <th>To</th>
            <th>TCGA Patient ID</th>
        </tr>
        {% for k, v in test_result.items %}
        <tr>
            <td>{{ k }}</td>
            <td>{{ v }}</td>
            <td>{{ v }}</td>
            <td>{{ v }}</td>
            <td>{{ v }}</td>
            <td>{{ v }}</td>
        </tr>
        {% endfor %}
    </table>
    <div id="visulize" {% if visulize %}{% endif %}>
        <img src="{{ visulize }}">
    </div>

</body>
<script>
    var status = document.getElementById("task_status").value;
    console.log(status);

     // 定义一个读取日志的方法，对日志的内容进行获取并调整前端的显示
    function readLog() {
        var cook_info = document.cookie;
        cook_info = cook_info.split(";");
        var username;
        // 首先从cookie中获取用户名
        for (var i = 0; i < cook_info.length; i++) {
            var info = cook_info[i].trim().split("=");
            if (info[0] == "cname") {
                username = info[2].split('"')[0];
                console.log(username);
            }
        }
        var has_result = null;
        $.ajax({
            type: "post",
            url: "/check_log/log_res/",
            dataType: "json",
            data: {"username": username},
            async: false,
            success: function (ret) {
                has_result = ret.log_result;
                console.log("日志查询成功");
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                console.log(XMLHttpRequest.status);
                console.log(XMLHttpRequest.readyState);
                console.log(textStatus);
                console.log("日志查询失败");
                has_result = false;
            }
        });
        return has_result;
    }
    
</script>
</html>